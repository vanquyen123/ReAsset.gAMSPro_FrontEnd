<div [@routerTransition]>
  <appToolbar_re #appToolbar></appToolbar_re>
  <div class="m-subheader">
      <div class="row align-items-center">
          <div class="mr-auto col-auto">
              <!-- Begin Title -->
              <a [routerLink]="rootPage()" class="m-subheader__title m-subheader__title--separator link-to-list-page home-page">
                  <span>{{l("HomePage")}}</span>
              </a>
              <h3 (click)="goBack()" class="m-subheader__title m-subheader__title--separator link-to-list-page">
                  <span>Danh sách khu đất</span>
              </h3>
              <span [ngSwitch]="editPageState" class="m-section__sub">
                  <span *ngSwitchCase="EditPageState.add">{{l("Toolbar_Create")}}</span>
                  <span *ngSwitchCase="EditPageState.edit">{{l("Toolbar_Update")}}</span>
                  <span *ngSwitchCase="EditPageState.viewDetail">{{l("Toolbar_ViewDetail")}}</span>
              </span>
              <!-- End Title -->
          </div>
          <div class="col text-right mt-3 mt-md-0 mr-4">
            <div class="btn-group dropdown">
                <button class="btn btn-outline-success"
                *ngIf="editPageState=='ViewDetail'"
                    (click)="exportToExcel()">
                    <i class="far fa-file-excel"></i>
                    {{l("ExcelOperations")}}
                </button>
            </div>
          </div>
      </div>
  </div>

  <div id="content" class="m-content">
      <div class="m-portlet m-portlet--mobile">
          <div class="m-portlet__body">
              <!-- Begin Form -->
              <form #editForm="ngForm" id="editForm" novalidate (ngSubmit)="saveInput()" autocomplete="off">
                  <div class="modal-body row">
                      <div class="col-md-12 align-right">
                          <div class="form-group">
                              <auth-status-2-input-page [authStatus]="inputModel.autH_STATUS"></auth-status-2-input-page>
                          </div>
                      </div>
                      <div class="col-md-12" *ngIf="inputModel.autH_STATUS == 'R' && (editPageState == 'Edit' || editPageState == 'ViewDetail')">
                        <div class="row">
                            <div class="col-md-12">
                                <h4>NỘI DUNG TRẢ VỀ</h4>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Người trả về</label>
                                    <input disabled class="form-control" name="checkeR_NAME" type="text" [(ngModel)]="inputModel.checkeR_NAME">
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label>Lý do trả về</label>
                                    <textarea disabled class="form-control" name="rejecT_REASON" type="text" [(ngModel)]="inputModel.rejecT_REASON"></textarea>
                                </div>
                              </div>
                        </div>
                      </div>
                      <div class="col-md-12" *ngIf="inputModel.autH_STATUS == 'C' && (editPageState == 'Edit' || editPageState == 'ViewDetail')">
                        <div class="row">
                            <div class="col-md-12">
                                <h4>NỘI DUNG HỦY</h4>
                            </div>
      
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Người hủy</label>
                                    <input disabled class="form-control" name="checkeR_NAME" type="text" [(ngModel)]="inputModel.checkeR_NAME">
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label>Lý do hủy</label>
                                    <textarea disabled class="form-control" name="rejecT_REASON" type="text" [(ngModel)]="inputModel.rejecT_REASON"></textarea>
                                </div>
                              </div>
                        </div>
                      </div>
                      <div class="col-md-12">
                          <div class="row">
                            <div class="col-md-12">
                              <h3>THÔNG TIN CHUNG</h3>
                            </div>
                            
                            <div class="col-md-4">
                              <div class="form-group">
                                  <label>Người tạo</label>
                                  <input disabled class="form-control" type="text" #makeR_NAME="ngModel" name="makeR_NAME" [(ngModel)]="inputModel.makeR_NAME">
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group">
                                <label>Ngày tạo</label>
                                <date-control
                                [disabled] = "true"
                                #creatE_DT="ngModel"
                                name="creatE_DT"
                                [(ngModel)]="inputModel.creatE_DT"
                                autoFocus>
                                </date-control>
                              </div>
                            </div>
                            <div class="col-md-4"></div>
                            <div class="col-md-4" *ngIf="editPageState == 'Edit' || editPageState == 'ViewDetail'">
                              <div class="form-group">
                                  <label>Người chỉnh sửa cuối</label>
                                  <input disabled class="form-control" type="text" #modifieR_NAME="ngModel" name="modifieR_NAME" [(ngModel)]="inputModel.modifieR_NAME">
                              </div>
                            </div>
                            <div class="col-md-4" *ngIf="editPageState == 'Edit' || editPageState == 'ViewDetail'">
                              <div class="form-group">
                                <label>Ngày chỉnh sửa cuối</label>
                                <date-control
                                [disabled] = "true"
                                #modifY_DT="ngModel"
                                name="modifY_DT"
                                [(ngModel)]="inputModel.modifY_DT"
                                autoFocus>
                                </date-control>
                              </div>
                            </div>
                            <div class="col-md-12">
                              <h4>THÔNG TIN KHU ĐẤT</h4>
                            </div>

                            <div class="col-md-4">
                              <div class="form-group">
                                  <label>Mã khu đất</label>
                                  <input disabled class="form-control" type="text" #lanD_AREA_ID="ngModel" name="lanD_AREA_ID" [(ngModel)]="inputModel.id">
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group required">
                                  <label>Dự án</label>
                                  <select2-custom (onChangeSelect2)="onSelect($event)"
                                    required
                                    class="transparent"
                                    [disabled]="disableInput"
                                    #projecT_ID="ngModel"
                                    name="projecT_ID"
                                    [(ngModel)]="inputModel.projecT_ID"
                                    [(list)]="projectList"
                                    [valueMember]="'id'"
                                    [displayMember]="'name'"
                                    >
                                  </select2-custom>
                                  <div class="error-message" *ngIf="projecT_ID.invalid && isShowError">
                                    <span *ngIf="projecT_ID?.errors.required">Dự án
                                        {{l("ValidationRequired")}}</span>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group required">
                                  <label>Tên khu đất</label>
                                  <input required [disabled]="disableInput" class="form-control" type="text" #lanD_AREA_NAME="ngModel" name="lanD_AREA_NAME" [(ngModel)]="inputModel.lanD_AREA_NAME">
                                  <div class="error-message" *ngIf="lanD_AREA_NAME.invalid && isShowError">
                                      <span *ngIf="lanD_AREA_NAME?.errors.required">Tên khu đất
                                          {{l("ValidationRequired")}}</span>
                                  </div>
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group ">
                                  <label>Quy mô (m2)</label>
                                  <input [disabled]="disableInput" class="form-control" type="text" #lanD_AREA_SCALE="ngModel" name="lanD_AREA_SCALE" [(ngModel)]="inputModel.lanD_AREA_SCALE">
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group ">
                                  <label>Địa điểm</label>
                                  <input [disabled]="disableInput" class="form-control" type="text" #lanD_AREA_LOCATION="ngModel" name="lanD_AREA_LOCATION" [(ngModel)]="inputModel.lanD_AREA_LOCATION">
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group">
                                  <label>Chủ đầu tư</label>
                                  <select2-custom (onChangeSelect2)="onSelect($event)"
                                    class="transparent"
                                    [disabled]="disableInput"
                                    #investoR_ID="ngModel"
                                    name="investoR_ID"
                                    [(ngModel)]="inputModel.investoR_ID"
                                    [(list)]="investorList"
                                    [emptyText]=""
                                    [valueMember]="'id'"
                                    [displayMember]="'name'"
                                    >
                                  </select2-custom>
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group">
                                  <label>Pháp lý</label>
                                  <input [disabled]="disableInput" class="form-control" type="text" #lanD_AREA_LIABILITY="ngModel" name="lanD_AREA_LIABILITY" [(ngModel)]="inputModel.lanD_AREA_LIABILITY">
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group">
                                  <label>Hình đính kèm</label>
                                  <div class="file-input-group file-group">
                                    <input class="form-control" readonly type="text" [(ngModel)]="uploadedFile.filE_NAME" name="attacheD_IMAGE" />
                                    <input class="form-control" hidden type="file" #attachFile (change)="onUploadImage($event)" accept="image/x-png,image/gif,image/jpeg" />
                                    <button style="margin:0px !important;" *ngIf="!uploadedFile.filE_NAME" type="button" class="btn btn-primary" [disabled]="disableInput" (click)="selectFile()"><i class="fa fa-plus mx-auto"></i></button>
                                    <button *ngIf="uploadedFile.filE_NAME" type="button" class="btn btn-primary" [disabled]="disableInput" (click)="selectFile()"><i class="fa fa-pen"></i></button>
                                    <button style="margin:0px !important;" *ngIf="uploadedFile.filE_NAME" type="button" class="btn btn-danger" [disabled]="disableInput" (click)="removeFile()"><i class="fa fa-eraser"></i></button>
                                  </div>
                              </div>
                            </div>
                            <div class="col-md-8">
                              <div class="form-group">
                                  <label>{{l("Note")}}</label>
                                  <textarea class="form-control" [disabled]="disableInput" type="text" #notes="ngModel" name="notes" [(ngModel)]="inputModel.notes"></textarea>
                              </div>
                            </div>

                            <div class="col-md-12">
                              <h4>ĐỊNH GIÁ</h4>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group">
                                  <label>Giá trị định giá (tỷ đồng) (không bao gồm tiền sử dụng đất)</label>
                                  <input [disabled]="disableInput" class="form-control" type="number" #valuatioN_BEFORE_VALUE="ngModel" name="valuatioN_BEFORE_VALUE" [(ngModel)]="inputModel.valuation.valuatioN_BEFORE_VALUE">
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group">
                                  <label>Tiền sử dụng đất (tỷ đồng)</label>
                                  <input [disabled]="disableInput" class="form-control" type="number" #lanD_USE_FEE="ngModel" name="lanD_USE_FEE" [(ngModel)]="inputModel.valuation.lanD_USE_FEE">
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group">
                                <label>Ngày định giá</label>
                                <date-control
                                [disabled] = "disableInput"
                                #valuatioN_DT="ngModel"
                                name="valuatioN_DT"
                                [(ngModel)]="inputModel.valuation.valuatioN_DT"
                                autoFocus>
                                </date-control>
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group">
                                  <label>Phương pháp định giá</label>
                                  <input [disabled]="disableInput" class="form-control" type="text" #valuatioN_METHOD="ngModel" name="valuatioN_METHOD" [(ngModel)]="inputModel.valuation.valuatioN_METHOD">
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group">
                                  <label>Đơn vị định giá</label>
                                  <select2-custom (onChangeSelect2)="onSelect($event)"
                                    class="transparent"
                                    [disabled]="disableInput"
                                    #valuatioN_PARTY_ID="ngModel"
                                    name="valuatioN_PARTY_ID"
                                    [(ngModel)]="inputModel.valuation.valuatioN_PARTY_ID"
                                    [(list)]="partnerList"
                                    [valueMember]="'id'"
                                    [displayMember]="'name'"
                                    >
                                  </select2-custom>
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group">
                                  <label>Kế hoạch mở bán</label>
                                  <input [disabled]="disableInput" class="form-control" type="text" #valuatioN_SALE_PLAN="ngModel" name="valuatioN_SALE_PLAN" [(ngModel)]="inputModel.valuation.valuatioN_SALE_PLAN">
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group">
                                  <label>Loại hình sản phẩm dự kiến</label>
                                  <input [disabled]="disableInput" class="form-control" type="text" #valuatioN_PRODUCT_TYPE="ngModel" name="valuatioN_PRODUCT_TYPE" [(ngModel)]="inputModel.valuation.valuatioN_PRODUCT_TYPE">
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="form-group">
                                  <label>Giá bán bình quân/m2 (triệu đồng)</label>
                                  <input [disabled]="disableInput" class="form-control" type="text" #valuatioN_UNIT_SALE_PRICE="ngModel" name="valuatioN_UNIT_SALE_PRICE" [(ngModel)]="inputModel.valuation.valuatioN_UNIT_SALE_PRICE">
                              </div>
                            </div>

                          </div>
                      </div>
                      
                      <div class="col-md-12 mt-3">
                        <h4>TÌNH TRẠNG ĐĂNG KÝ SỬ DỤNG TÀI SẢN</h4>
                      </div>
                      <div class="action-button col-md-12">
                        <button type="button" [disabled]="disableInput" class="btn btn-primary" (click)="addNewUseRegistration()"><i class="pi pi-plus"></i>{{l("Add")}}</button>
                        <button type="button" [disabled]="disableInput" class="btn btn-danger" (click)="removeUseRegistration()"><i
                                class="pi pi-times"></i>{{l("Delete")}}</button>
                      </div>
                      <div class="primeng-datatable-container col-md-12">
                        <editable-table #useRegistrationEditTable class="custom-table ui-table">
                            <thead>
                                <tr>
  
                                    <th>
                                        <span style="width: 40px">
                                            <checkbox-control [disabled]="disableInput" (onchange)="checkAllRegistration($event.target.checked)" [checked]="useRegistrationEditTable.isCheckAll"></checkbox-control>
                                        </span>
                                    </th>
                                    <th><span style="width: 40px">{{l("No")}}</span></th>
  
                                    <th sortField="propertY_ID"><span style="width: 150px">Đơn vị đăng ký</span></th>
                                    <th style="width:50%"><span style="width: 150px">Người đăng ký</span></th>
                                    <th style="width:50%" ><span style="width: 150px">Ngày đăng ký</span></th>
                                    <th><span style="width: 150px">Thời gian đăng ký</span></th>
                                    <th sortField="valuatioN_VALUE"><span style="width: 150px">Ngày hết hạn giữ</span></th>
                                    <th sortField="valuatioN_PARTY_ID"><span style="width: 150px">Mục đích sử dụng</span></th>
                                    <th sortField="valuatioN_DT"><span style="width: 150px">{{l("Note")}}</span></th>
                                    
                                </tr>
  
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of useRegistrationEditTable.dataInPage" #editRow ng-form [hidden]="item.page != useRegistrationEditTable.currentPage">
  
                                    <td class="center">
                                        <span class="mo-header"></span>
                                        <checkbox-control [disabled]="disableInput" (onchange)="checkedUseRegistration(item, $event.target.checked)" [checked]="item['isChecked']"></checkbox-control>
                                    </td>
  
                                    <td class="center"><span class="mo-header"></span>{{item.no}}</td>
                                    <td>
                                      <span class="mo-header"></span>
                                      <select2-custom (onChangeSelect2)="onSelect($event)"
                                        class="transparent m-input"
                                        [disabled]="disableInput"
                                        #departmenT_ID="ngModel"
                                        name="departmenT_ID{{item.no}}"
                                        [(ngModel)]="item.departmenT_ID"
                                        [(list)]="departmentList"
                                        [valueMember]="'id'"
                                        [displayMember]="'name'"
                                        >
                                      </select2-custom> 
                                    </td>
                                    <td>
                                      <span class="mo-header"></span>
                                      <select2-custom (onChangeSelect2)="onSelect($event)"
                                        class="transparent m-input"
                                        [disabled]="disableInput"
                                        #registoR_ID="ngModel"
                                        name="registoR_ID{{item.no}}"
                                        [(ngModel)]="item.registoR_ID"
                                        [(list)]="registorList"
                                        [valueMember]="'id'"
                                        [displayMember]="'name'"
                                        >
                                      </select2-custom> 
                                    </td>
                                    <td class="center">
                                      <span class="mo-header"></span>
                                      <date-control 
                                      [disabled]="disableInput"
                                      name="usE_REGISTRATION_DT{{item.no}}"
                                      [(ngModel)]="item.usE_REGISTRATION_DT"
                                      (change)="updateRegistrationExpiredDate(item.no-1, item.usE_REGISTRATION_DT, item.registerPeriod)"
                                      autoFocus>
                                      </date-control>
                                    </td>
                                    <td>
                                      <span class="mo-header"></span>
                                      <input 
                                      [disabled]="disableInput" 
                                      name="registerPeriod{{item.no}}" 
                                      class="form-control m-input" 
                                      [(ngModel)]="item.registerPeriod" 
                                      (change)="updateRegistrationExpiredDate(item.no-1, item.usE_REGISTRATION_DT, item.registerPeriod)">
                                    </td>
                                    <td class="center">
                                      <span class="mo-header"></span>
                                      <date-control 
                                      [disabled]="true"
                                      name="usE_REGISTRATION_EXPIRE_DT{{item.no}}"
                                      [(ngModel)]="item.usE_REGISTRATION_EXPIRE_DT"
                                      autoFocus>
                                      </date-control>
                                    </td>
                                    <td>
                                      <span class="mo-header"></span>
                                      <input [disabled]="disableInput" name="usE_REGISTRATION_USE_PUREPOSE{{item.no}}" class="form-control m-input" [(ngModel)]="item.usE_REGISTRATION_USE_PURPOSE">
                                    </td>
                                    <td>
                                      <span class="mo-header"></span>
                                      <input [disabled]="disableInput" name="notes{{item.no}}" class="form-control m-input" [(ngModel)]="item.notes">
                                    </td>
                                </tr>
                            </tbody>
                        </editable-table>
                      </div>

                      <div class="col-md-12 mt-3" *ngIf="sodoEditTable">
                        <h4>TÌNH TRẠNG SỞ HỮU</h4>
                      </div>
                      <div class="col-md-12" *ngIf="sodoEditTable">
                        <h5>Sổ đỏ</h5>
                      </div>
                      <div class="primeng-datatable-container col-md-12" *ngIf="sodoEditTable">
                        <editable-table #sodoEditTable class="custom-table ui-table">
                            <thead>
                                <tr>
                                    <th><span style="width: 40px">{{l("No")}}</span></th>
                                    <th sortField="propertY_ID"><span style="width: 150px">Mã sổ</span></th>
                                    <th style="width:50%"><span style="width: 150px">Quy mô (m2)</span></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of sodoEditTable.dataInPage" #editRow ng-form [hidden]="item.page != sodoEditTable.currentPage">
                                    <td class="center"><span class="mo-header"></span>{{item.no}}</td>
                                    <td>
                                      <a href="/app/admin/sodo-view;sodo={{ item.id }}">
                                        <span class="mo-header"></span>{{ item.id }}
                                      </a>
                                    </td>
                                    <td>
                                      <span class="mo-header"></span>{{ item.sodO_AREA }}
                                    </td>
                                </tr>
                            </tbody>
                        </editable-table>
                      </div>

                  </div>
              </form>
              <!-- Begin Form -->
          </div>
      </div>
  </div>
</div>
